/*! jsVideoViewer.js v0.0.1 | AGPL v3 license */
var jsVideoViewer360=function(e){this.video=null;this.options={el:null,fps:12,frames:24,rotation:"clockwise",moveInterval:100,cursor:"pointer"};this.state={lastX:0,paused:false,mouseDown:false,isChrome:window.chrome};this.init=function(){if(e){this.setEl(e.el);this.setFps(e.fps);this.setFrames(e.frames);this.setRotation(e.rotation);this.setMoveInterval(e.moveInterval);this.setCursor(e.cursor)}this.setVideo();this.initVideo();this.tMove=this.throttle(this.move,this.options.moveInterval)};this.setEl=function(e){this.options.el=$("#"+e)};this.getEl=function(){if(this.options.el==null){throw new Error("el is not defined")}return this.options.el};this.setVideo=function(){this.video=$("<video />")};this.setFps=function(e){if(e!==undefined){this.options.fps=e}};this.setFrames=function(e){if(e!==undefined){this.options.frames=e}};this.setRotation=function(e){if(e=="clockwise"||e=="counterclockwise"){this.options.rotation=e}};this.setMoveInterval=function(e){if(e!==undefined){this.options.moveInterval=e}};this.setCursor=function(e){if(e!==undefined){this.options.cursor=e}};this.initVideo=function(){var e=this;this.video.attr("loop","loop");this.video.css("cursor",e.options.cursor);this.video.on({loadedmetadata:function(){e.getEl().append(e.video);e.play()},mousedown:function(t){e.state.mouseDown=true;e.state.lastX=t.pageX;e.pause()},mouseup:function(){e.state.mouseDown=false;e.play()},mouseout:function(){e.state.mouseDown=false;e.play()},mousemove:function(t){if(e.state.mouseDown){if(t.pageX>e.state.lastX){e.tMove("backward")}if(t.pageX<e.state.lastX){e.tMove("forward")}e.state.lastX=t.pageX}return false}});var t=this.getEl().attr("data-src");this.video.attr("src",t)};this.getForwardTime=function(e){var t=this.getCurrentFrame()+1;var n=this.getFrameTime();var r=this.getSemiFrameTime();var i=n*t+r;return i>e.duration?r:i};this.moveForward=function(){var e=this.video.get(0);e.currentTime=this.getForwardTime(e)};this.getBackwardTime=function(e){var t=this.getCurrentFrame()-1;var n=this.getFrameTime();var r=this.getSemiFrameTime();var i=n*t;if(i<0){return this.state.isChrome?e.duration-n-r:e.duration-r}else{return i+r}};this.getFrameTime=function(){return 1/this.options.fps};this.getSemiFrameTime=function(){return this.getFrameTime()/2};this.moveBackward=function(){var e=this.video.get(0);e.currentTime=this.getBackwardTime(e)};this.forward=function(){this.move("forward")};this.backward=function(){this.move("backward")};this.move=function(e){if(this.options.rotation=="counterclockwise"){e=e=="forward"?"backward":"forward"}if(e=="forward"){this.moveForward()}else{this.moveBackward()}};this.play=function(){this.video.get(0).play()};this.pause=function(){this.video.get(0).pause()};this.isPaused=function(){return this.video.get(0).paused};this.getCurrentFrame=function(){return Math.floor(this.video.get(0).currentTime*this.options.fps)};this.now=Date.now||function(){return(new Date).getTime()};this.throttle=function(e,t,n){var r,i,s;var o=null;var u=0;if(!n)n={};var a=this;var f=function(){u=n.leading===false?0:a.now();o=null;s=e.apply(r,i);if(!o)r=i=null};return function(){var l=a.now();if(!u&&n.leading===false){u=l}var c=t-(l-u);r=this;i=arguments;if(c<=0||c>t){clearTimeout(o);o=null;u=l;s=e.apply(r,i);if(!o)r=i=null}else if(!o&&n.trailing!==false){o=setTimeout(f,c)}return s}}}
